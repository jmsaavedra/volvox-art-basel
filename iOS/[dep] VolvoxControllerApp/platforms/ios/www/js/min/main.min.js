function getFavList(e){var a=[];return app.main.dataFromServer.forEach(function(t){t.properties.forEach(function(t){e.forEach(function(e){t.id===e&&a.push({id:t.id,name:t.name})})})}),console.log(a),a}function getFav(e){console.log("seeking fav",e);var a=!1;return CLIENT.favorites.forEach(function(t){t===e&&(a=!0,console.log("this prop is favorited"))}),a}function getIndexByName(e){var a;return app.main.dataFromServer.forEach(function(t,i){t.name===e&&(a=i)}),a}function getIndexByNameProp(e,a){var t;return app.main.dataFromServer[e].properties.forEach(function(e,i){e.name===a&&(t=i)}),t}function generateUUID(){var e=(new Date).getTime(),a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var t=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==a?t:7&t|8).toString(16)});return a}var CLIENT={session_id:"",server_address:"http://localhost:8080",page_id:"",img_id:"",img_direction:"",screen_id:1,favorites:[]},app=app||{};app.title="Douglas Elliman",app.phonegap=function(){var e=function(){window.alert=function(e,a){navigator.notification?navigator.notification.alert(e,a(),app.title,"OK"):alert(app.title?app.title+": "+e:e)},window.prompt=function(e,a,t){navigator.notification&&navigator.notification.prompt(e,a,app.title,["OK"],t)}},a=function(){function e(e){return CLIENT.screen_id===e?"SCREEN "+e+" (Selected)":"SCREEN "+e}var a={title:"Session: "+CLIENT.session_id,buttonLabels:[e(1),e(2),"Change Server Address","Reset App"],addCancelButtonWithLabel:"Cancel",addDestructiveButtonWithLabel:"Restart Session"},t=function(e){setTimeout(function(){2===e?CLIENT.screen_id=1:3===e?CLIENT.screen_id=2:1===e?alert("App restarted.",function(){CLIENT.favorites=[],app.main.updateLS(),window.location.reload()}):4===e?prompt("Input new server address below.",function(e){CLIENT.server_address=e.input1,app.main.updateLS()},CLIENT.server_address):5===e&&(localStorage.clear(),alert("App reset. Cache cleared.",function(){window.location.reload()}))})};window.plugins.actionsheet.show(a,t)};return{init:e,actionSheet:a}}(),app.main=function(){var e,a,t,i={},o=function(){console.log("APP INIT!"),app.phonegap.init(),FastClick.attach(document.body),n(),CLIENT.session_id=generateUUID(),l(),p(),window.location.hash="/cities",s()},n=function(){void 0===localStorage.app?localStorage.app=JSON.stringify(CLIENT):CLIENT=JSON.parse(localStorage.app)},r=function(){console.log("update LS"),localStorage.app=JSON.stringify(CLIENT)},p=function(){$.get(CLIENT.server_address+"/init",function(e){e.length>0?(app.main.dataFromServer=e,$(window).trigger("getDataSuccess")):prompt("Could not connect to the server. Please correct the server address.",function(e){CLIENT.server_address=e.input1,app.main.updateLS(),alert("App will now reload.",function(){window.location.reload()})},CLIENT.server_address)})},s=function(){routie({"/cities":function(){console.log("Page: cities"),CLIENT.page_id="allLocation",c({tpl:"tpl-list-locations",page:"locations",header:"Locations"},function(){app.main._compiled=_.template(app.main._template,{header_title:app.main._objData.header,list_locations:app.main.dataFromServer}),$("#view").html(app.main._compiled)})},"/cities/:city":function(e){console.log("Page: "+e),CLIENT.page_id=app.main.dataFromServer[getIndexByName(e)].id,c({tpl:"tpl-list-props",header:e,page:e},function(){app.main._compiled=_.template(app.main._template,{fav:CLIENT.favorites,back:!0,current_hash:window.location.hash,header_title:app.main._objData.header,list_properties:app.main.dataFromServer[getIndexByName(e)].properties}),$("#view").html(app.main._compiled)})},"/cities/:city/:property":function(e,a){console.log("Page: "+a);var t=getIndexByName(e),i=getIndexByNameProp(t,a);CLIENT.page_id=app.main.dataFromServer[t].properties[i].id,c({tpl:"tpl-prop-detail",header:a,page:a},function(){app.main._compiled=_.template(app.main._template,{back:!0,fav:getFav(CLIENT.page_id),server_address:CLIENT.server_address,header_title:app.main._objData.header,images:app.main.dataFromServer[t].properties[i].img,info:app.main.dataFromServer[t].properties[i].info}),$("#view").html(app.main._compiled);var e=0;$(".slick_carousel").slick({infinite:!1,accessibility:!0,autoplay:!1,dots:!0,onAfterChange:function(a,t){t>e?(CLIENT.img_direction="right",console.log("right")):e>t&&(CLIENT.img_direction="left",console.log("left")),$.post(CLIENT.server_address+"/update",CLIENT,function(){}),e=t}})})},"/share":function(){console.log("Page: /share"),c({tpl:"tpl-share",header:"Share",page:"share",back:!0},function(){app.main._compiled=_.template(app.main._template,{back:!0,server_address:CLIENT.server_address,header_title:app.main._objData.header,fav_list:getFavList(CLIENT.favorites)}),$("#view").html(app.main._compiled)})},"/about":function(){console.log("Page: /about"),c({tpl:"tpl-about",header:"About",page:"about",back:!0},function(){app.main._compiled=_.template(app.main._template,{back:!0,header_title:app.main._objData.header}),$("#view").html(app.main._compiled)})}})},c=function(e,a){$.post(CLIENT.server_address+"/update",CLIENT,function(){$(window).on("ajaxSuccess",function(){console.log("-----Update to server Success"),$(this).off("ajaxSuccess"),app.main._objData=e,app.main._template=$("#"+e.tpl).html(),void 0!==a&&(a(),l())})})},l=function(){console.log("attaching events"),$(window).off("getDataSuccess").on("getDataSuccess",function(){console.log("Page: cities"),CLIENT.page_id="allLocation",c({tpl:"tpl-list-locations",page:"locations",header:"Locations"},function(){app.main._compiled=_.template(app.main._template,{header_title:app.main._objData.header,list_locations:app.main.dataFromServer}),$("#view").html(app.main._compiled)})}),$(".backBtn").off("click").on("click",function(){window.history.back()}),$(".favBtn").off("click").on("click",function(){var e=$(this);e.hasClass("faved")?(e.removeClass("faved"),CLIENT.favorites.splice(CLIENT.favorites.indexOf(CLIENT.page_id),1)):(e.addClass("faved"),CLIENT.favorites.push(CLIENT.page_id),CLIENT.favorites=_.unique(CLIENT.favorites)),app.main.updateLS(),$.post(CLIENT.server_address+"/update",CLIENT,function(){})}),$("#share_submit").off("click").on("click",function(){var e={firstName:$("#share_first_name").val(),lastName:$("#share_last_name").val(),email:$("#share_email").val(),favorites:CLIENT.favorites};$.ajax({url:CLIENT.server_address+"/share",dataType:"json",method:"POST",data:e,success:function(){alert("Information sent. App restarted.",function(){CLIENT.favorites=[],app.main.updateLS(),window.location.reload()})},error:function(){alert("Information sent. App restarted.",function(){CLIENT.favorites=[],app.main.updateLS(),window.location.reload()})}})}),$(".fav_delete").off("click").on("click",function(){var e=$(this).parent().attr("data-id");$(this).parent().slideUp(function(){$(this).remove(),CLIENT.favorites.splice(CLIENT.favorites.indexOf(e),1),app.main.updateLS()})}),$("footer .left").off("click").on("click",function(){app.phonegap.actionSheet()})};return{init:o,dataFromServer:i,initServerCall:p,_compiled:e,_template:a,_objData:t,updateLS:r}}(),Zepto.os.ios?Zepto(document).on("deviceready",app.main.init):app.main.init();