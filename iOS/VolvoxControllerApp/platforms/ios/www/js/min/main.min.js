function getFav(e){console.log("seeking fav",e);var a=!1;return CLIENT.favorites.forEach(function(t){t===e&&(a=!0,console.log("this prop is favorited"))}),a}function getIndexByName(e){var a;return app.main.dataFromServer.forEach(function(t,i){t.name===e&&(a=i)}),a}function getIndexByNameProp(e,a){var t;return app.main.dataFromServer[e].properties.forEach(function(e,i){e.name===a&&(t=i)}),t}function generateUUID(){var e=(new Date).getTime(),a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var t=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==a?t:7&t|8).toString(16)});return a}var CLIENT={session_id:"",server_address:"http://localhost:8080",page_id:"",screen_id:1,favorites:[]},app=app||{};app.title="Douglas Elliman",app.main=function(){var e,a,t,i={},n=function(){app.phonegap.init(),FastClick.attach(document.body),o(),CLIENT.session_id=generateUUID(),l(),r(),window.location.hash="/cities",s()},o=function(){void 0===localStorage.app?localStorage.app=JSON.stringify(CLIENT):CLIENT=JSON.parse(localStorage.app)},p=function(){console.log("update LS"),localStorage.app=JSON.stringify(CLIENT)},r=function(){$.get(CLIENT.server_address+"/init",function(e){e.length>0&&(app.main.dataFromServer=e,$(window).trigger("getDataSuccess"))})},s=function(){routie({"/cities":function(){console.log("Page: cities"),CLIENT.page_id="allLocation",c({tpl:"tpl-list-locations",page:"locations",header:"Locations"},function(){app.main._compiled=_.template(app.main._template,{header_title:app.main._objData.header,list_locations:app.main.dataFromServer}),$("#view").html(app.main._compiled)})},"/cities/:city":function(e){console.log("Page: "+e),CLIENT.page_id=app.main.dataFromServer[getIndexByName(e)].id,c({tpl:"tpl-list-props",header:e,page:e},function(){app.main._compiled=_.template(app.main._template,{fav:CLIENT.favorites,back:!0,current_hash:window.location.hash,header_title:app.main._objData.header,list_properties:app.main.dataFromServer[getIndexByName(e)].properties}),$("#view").html(app.main._compiled)})},"/cities/:city/:property":function(e,a){console.log("Page: "+a);var t=getIndexByName(e),i=getIndexByNameProp(t,a);CLIENT.page_id=app.main.dataFromServer[t].properties[i].id,c({tpl:"tpl-prop-detail",header:a,page:a},function(){app.main._compiled=_.template(app.main._template,{back:!0,fav:getFav(CLIENT.page_id),server_address:CLIENT.server_address,header_title:app.main._objData.header,images:app.main.dataFromServer[t].properties[i].img,info:app.main.dataFromServer[t].properties[i].info}),$("#view").html(app.main._compiled),$(".slick_carousel").slick({infinite:!1,accessibility:!0,autoplay:!1,dots:!0})})},"/share":function(){console.log("Page: /share"),c({tpl:"tpl-share",header:"Share",page:"share",back:!0},function(){app.main._compiled=_.template(app.main._template,{back:!0,server_address:CLIENT.server_address,header_title:app.main._objData.header}),$("#view").html(app.main._compiled)})}})},c=function(e,a){$.post(CLIENT.server_address+"/update",CLIENT,function(){$(window).on("ajaxSuccess",function(){console.log("-----Update to server Success"),$(this).off("ajaxSuccess"),app.main._objData=e,app.main._template=$("#"+e.tpl).html(),void 0!==a&&(a(),l())})})},l=function(){console.log("attaching events"),$(window).off("getDataSuccess").on("getDataSuccess",function(){console.log("Page: cities"),CLIENT.page_id="allLocation",c({tpl:"tpl-list-locations",page:"locations",header:"Locations"},function(){app.main._compiled=_.template(app.main._template,{header_title:app.main._objData.header,list_locations:app.main.dataFromServer}),$("#view").html(app.main._compiled)})}),$(".backBtn").off("click").on("click",function(){window.history.back()}),$(".favBtn").off("click").on("click",function(){var e=$(this);e.hasClass("faved")?(e.removeClass("faved"),CLIENT.favorites.splice(CLIENT.page_id,1)):(e.addClass("faved"),CLIENT.favorites.push(CLIENT.page_id),CLIENT.favorites=_.unique(CLIENT.favorites)),app.main.updateLS()}),$("footer .left").off("click").on("click",function(){app.phonegap.actionSheet()}),$(".page").off("webkitTransitionEnd").one("webkitTransitionEnd",function(){$(this).addClass("end")}),$(".end").off("webkitTransitionEnd").one("webkitTransitionEnd",function(){$(this).remove()})};return{init:n,dataFromServer:i,initServerCall:r,_compiled:e,_template:a,_objData:t,updateLS:p}}(),Zepto.os.ios?Zepto(document).on("deviceready",app.main.init):app.main.init(),app.phonegap=function(){var e=function(){},a=function(){var e={title:"Session: "+CLIENT.session_id,buttonLabels:[screenCheck(1),screenCheck(2)],addCancelButtonWithLabel:"Cancel",addDestructiveButtonWithLabel:"Restart Session"};window.plugins.actionsheet.show(e,function(){setTimeout(function(){alert("button index clicked: "+buttonIndex)})})};return{init:e,actionSheet:a}}();