function getIndexByName(a){var e;return app.main.dataFromServer.forEach(function(t,i){t.name===a&&(e=i)}),e}function getIndexByNameProp(a,e){var t;return app.main.dataFromServer[a].properties.forEach(function(a,i){a.name===e&&(t=i)}),t}function generateUUID(){var a=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==e?t:7&t|8).toString(16)});return e}var CLIENT={session_id:"",server_address:"http://localhost:8080",page_id:"",screen_id:1,favorites:[]},app=app||{};app.main=function(){var a,e,t,i={},n=function(){FastClick.attach(document.body),o(),CLIENT.session_id=generateUUID(),l(),p(),window.location.hash="/cities",r()},o=function(){void 0===localStorage.app&&(localStorage.app=JSON.stringify(CLIENT))},p=function(){$.get(CLIENT.server_address+"/init",function(a){a.length>0&&(app.main.dataFromServer=a,$(window).trigger("getDataSuccess"))})},r=function(){routie({"/cities":function(){console.log("Page: cities"),CLIENT.page_id="allLocation",c({tpl:"tpl-list-locations",page:"locations",header:"Locations"},function(){app.main._compiled=_.template(app.main._template,{header_title:app.main._objData.header,list_locations:app.main.dataFromServer}),$("#view").html(app.main._compiled)})},"/cities/:city":function(a){console.log("Page: "+a),CLIENT.page_id=app.main.dataFromServer[getIndexByName(a)].id,c({tpl:"tpl-list-props",header:a,page:a,back:!0},function(){app.main._compiled=_.template(app.main._template,{current_hash:window.location.hash,header_title:app.main._objData.header,list_properties:app.main.dataFromServer[getIndexByName(a)].properties}),$("#view").html(app.main._compiled)})},"/cities/:city/:property":function(a,e){console.log("Page: "+e);var t=getIndexByName(a),i=getIndexByNameProp(t,e);CLIENT.page_id=app.main.dataFromServer[t].properties[i].id,c({tpl:"tpl-prop-detail",header:e,page:e,back:!0},function(){app.main._compiled=_.template(app.main._template,{header_title:app.main._objData.header,img:app.main.dataFromServer[t].properties[i].img,note:""}),$("#view").html(app.main._compiled)})},"/share":function(){console.log("Page: /share"),c({tpl:"tpl-share",header:"Share",page:"share",back:!0})}})},c=function(a,e){$.post(CLIENT.server_address+"/update",CLIENT,function(){$(window).on("ajaxSuccess",function(){console.log("-----ajax Success"),$(this).off("ajaxSuccess"),app.main._objData=a,app.main._template=$("#"+a.tpl).html(),void 0!==e&&e()}),l()})},l=function(){console.log("attaching events"),$(window).off("getDataSuccess").on("getDataSuccess",function(){console.log("Page: cities"),CLIENT.page_id="allLocation",c({tpl:"tpl-list-locations",page:"locations",header:"Locations"},function(){app.main._compiled=_.template(app.main._template,{header_title:app.main._objData.header,list_locations:app.main.dataFromServer}),$("#view").html(app.main._compiled)})}),$(".page").off("webkitTransitionEnd").one("webkitTransitionEnd",function(){$(this).addClass("end")}),$(".end").off("webkitTransitionEnd").one("webkitTransitionEnd",function(){$(this).remove()})};return{init:n,dataFromServer:i,initServerCall:p,_compiled:a,_template:e,_objData:t}}(),$.os.ios?$(document).on("deviceready",app.main.init):app.main.init();